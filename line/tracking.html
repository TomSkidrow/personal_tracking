<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="shortcut icon" href="img/customer-service.ico" />
    <meta charset="utf-8" />
    <meta name="author" content="Muhamad Nauval Azhar" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="This is a login page template based on Bootstrap 5"
    />
    <title>ติดตามสถานะเอกสาร</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Kanit:400,300&subset=thai,latin"
      rel="stylesheet"
      type="text/css"
    />
    <link href="../assets//css/timeline.css" />
  </head>
  <style>
    body {
      font-family: "Kanit", sans-serif;
    }

    h4 {
      color: rgba(132, 41, 234, 255);
    }
    body {
      margin-top: 20px;
      font-family: "Kanit", sans-serif;
    }
    .timeline {
      border-left: 3px solid #727cf5;
      border-bottom-right-radius: 4px;
      border-top-right-radius: 4px;
      background: rgba(114, 124, 245, 0.09);
      margin: 0 auto;
      letter-spacing: 0.2px;
      position: relative;
      line-height: 1.4em;
      font-size: 1.03em;
      padding: 50px;
      list-style: none;
      text-align: left;
      max-width: 40%;
    }

    @media (max-width: 767px) {
      .timeline {
        max-width: 98%;
        padding: 25px;
      }
    }

    .timeline h1 {
      font-weight: 300;
      font-size: 1.4em;
    }

    .timeline h2,
    .timeline h3 {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 10px;
    }

    .timeline .event {
      border-bottom: 1px dashed #e8ebf1;
      padding-bottom: 25px;
      margin-bottom: 25px;
      position: relative;
    }

    @media (max-width: 767px) {
      .timeline .event {
        padding-top: 30px;
      }
    }

    .timeline .event:last-of-type {
      padding-bottom: 0;
      margin-bottom: 0;
      border: none;
    }

    .timeline .event:before,
    .timeline .event:after {
      position: absolute;
      display: block;
      top: 0;
    }

    .timeline .event:before {
      left: -207px;
      content: attr(data-date);
      text-align: right;
      font-weight: 100;
      font-size: 0.9em;
      min-width: 120px;
    }

    @media (max-width: 767px) {
      .timeline .event:before {
        left: 0px;
        text-align: left;
      }
    }

    .timeline .event:after {
      -webkit-box-shadow: 0 0 0 3px #727cf5;
      box-shadow: 0 0 0 3px #727cf5;
      left: -55.8px;
      background: #fff;
      border-radius: 50%;
      height: 9px;
      width: 9px;
      content: "";
      top: 5px;
    }

    @media (max-width: 767px) {
      .timeline .event:after {
        left: -31.8px;
      }
    }

    .rtl .timeline {
      border-left: 0;
      text-align: right;
      border-bottom-right-radius: 0;
      border-top-right-radius: 0;
      border-bottom-left-radius: 4px;
      border-top-left-radius: 4px;
      border-right: 3px solid #727cf5;
    }

    .rtl .timeline .event::before {
      left: 0;
      right: -170px;
    }

    .rtl .timeline .event::after {
      left: 0;
      right: -55.8px;
    }
  </style>

  <body>
    <section class="h-100">
      <div class="container h-100">
        <div class="row justify-content-sm-center h-100">
          <div class="col-xxl-8 col-xl-6 col-lg-5 col-md-7 col-sm-9">
            <div class="text-center my-5">
              <img
                src="../assets/images/hr-manager.png"
                alt="logo"
                width="100"
              />
            </div>
            <div class="text-center my-1">
              <h4>Tracking Management</h4>
            </div>
            <div class="shadow-none p-1 mb-6 rounded">
              <div class="card-body p-3">
                <!-- <h1 class="fs-4 card-title fw-bold mb-4">ลงทะเบียนใช้งานระบบ</h1> -->
                <div class="mb-3">
                  <label class="mb-2 text-muted" for="name"
                    ><b>รหัสพนักงาน :</b> <span id="username"></span></label></br>
                  <label class="mb-2 text-muted" for="name">
                    <b>ชื่อ - นามสกุล :</b> <span id="names"></span> 
                </label></br>
                <label class="mb-2 text-muted" for="name">
                    <b>ตำแหน่ง :</b> <span id="position"></span> 
                </label></br>
                <label class="mb-2 text-muted" for="name">
                    <b>สังกัด :</b> <span id="office"></span> 
                </label></br>
                <label class="mb-2 text-muted" for="name">
                    <b>รายละเอียด :</b> <span id="detail"></span> 
                </label></br>
                </div>
              </div>
            </div>

            <div class="container">
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <h6 class="card-title">Timeline</h6>
                      <div id="content">
                        <ul class="timeline">
                          
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.19.0/sdk.js"></script>
  </body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
  $(document).ready(function () {
    function runApp(us) {
      liff
        .getProfile()
        .then((profile) => {
          const user_line_id = profile.userId;
          const line_displayname = profile.displayName;
          var username = $("#username").val();
          //var userID = userIDS;
          $.ajax({
            url: "../service/tracking.php",
            method: "POST",
            data: {
              user_line_id: user_line_id,
            },
            success: function (data) {
              //alert(data);
              console.log(data.result_tracking);
              $("#username").html(data.profile.emp_id)
              $("#names").html(data.profile.names)
              $("#position").html(data.profile.position)
              $("#office").html(data.profile.office)
              $("#detail").html(data.profile.detail)
              // ให้ data เป็นข้อมูลที่คุณให้มา
var resultTracking = data.result_tracking;
var html = "";
// ใช้ forEach วนลูปผ่านแต่ละชุดข้อมูล
resultTracking.forEach(function(item, index) {
//   console.log("Data " + (index + 1) + ":");
//   console.log("ID: " + item.id);
//   console.log("Request ID: " + item.request_id);
//   console.log("Status ID: " + item.status_id);
//   console.log("Tracking Detail: " + item.tracking_detail);
//   console.log("Created At: " + item.created_at);
  html += '<li class="event" data-date="' + item.created_at + '">';
    html += '<h3>สถานะ :' + item.status_name + '</h3>';
  html += '<p> รายละเอียด :' + item.tracking_detail + '</p>';
  html += '</li>';
  // เพิ่มข้อมูลอื่น ๆ ตามต้องการ
  console.log("-------------------------");
});
$(".timeline").html(html);
            },
          });
        })
        .catch((err) => console.error(err));
    }
    liff.init(
      { liffId: "2004718475-o6Q5qExD" },
      () => {
        if (liff.isLoggedIn()) {
          runApp();
        } else {
          liff.login();
        }
      },
      (err) => console.error(err.code, error.message)
    );
  });
</script>
